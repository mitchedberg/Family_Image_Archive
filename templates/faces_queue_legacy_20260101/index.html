<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Face Queue</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css?v=20251230_7" />
  </head>
  <body>
    <div class="queue-app">
      <header class="queue-app__header">
        <div class="summary">
          <div>
            <h1>Face Queue</h1>
            <p id="summary"></p>
          </div>
          <div class="controls">
            <label>
              <span>Active Label</span>
              <select id="label-select"></select>
            </label>
            <label>
              <span>Similarity</span>
              <input id="similarity-slider" type="range" min="0" max="1" step="0.01" />
              <strong id="similarity-value"></strong>
            </label>
            <button id="new-person-btn" type="button" title="New Person">New Person</button>
            <button id="refresh-btn" type="button" title="Next Candidate">Next Candidate</button>
          </div>
        </div>
        <div class="tips">
          Hotkeys: T = accept/save label · F = reject · S or → = skip · ← = previous queued photo · U = undo · C = next candidate · R = refresh current label · N = start new person.
        </div>
      </header>
      <main class="queue-main">
        <aside class="queue-sidebar">
          <div class="sidebar-header">
            <div>
              <h2>People</h2>
              <p>Select a person to review matches.</p>
            </div>
            <button id="sidebar-refresh-btn" type="button" aria-label="Refresh people list" title="Refresh people list">↻</button>
          </div>
          <div class="sidebar-filter">
            <input id="label-filter" type="search" placeholder="Filter people…" autocomplete="off" />
          </div>
          <div id="label-list" class="label-list">
            <p class="empty">No labels yet — add someone with “New Person”.</p>
          </div>
        </aside>
        <section class="candidate-panel">
          <div class="mode-tabs mode-tabs--primary">
            <button id="mode-person-btn" type="button" class="is-active" title="Person Review">Person Review</button>
            <button id="mode-photo-btn" type="button" title="Photo Tagger">Photo Tagger</button>
            <button id="mode-cluster-btn" type="button" title="Clusters">Clusters</button>
          </div>
          <div id="person-mode">
          <div class="candidate-panel__status">
            <span id="mode-indicator">Pick a label or start a new person.</span>
            <div class="label-tools">
              <div id="label-summary" class="label-summary">No label selected.</div>
              <button id="merge-open-btn" type="button" disabled title="Merge Labels">Merge Labels</button>
            </div>
          </div>
          <div class="view-tabs">
            <button id="view-single-btn" type="button" class="is-active" title="Single Queue">Single Queue</button>
            <button id="view-batch-btn" type="button" title="Batch Grid">Batch Grid</button>
          </div>
          <div id="candidate-body" class="candidate-panel__body">
            <div id="single-view" class="view-single">
              <div class="candidate-layout">
                <div class="candidate-layout__image">
                  <p class="empty">Loading…</p>
                </div>
                <div class="candidate-layout__details">
                  <div id="legacy-panel" class="legacy-panel is-hidden single-only">
                    <span id="legacy-text"></span>
                    <div id="legacy-chip-row" class="legacy-chip-row"></div>
                  </div>
                  <div class="candidate-face">
                    <canvas id="face-crop" class="candidate-face__canvas"></canvas>
                    <div class="candidate-face__label">Inset</div>
                  </div>
                  <ul class="candidate-meta">
                    <li><span>Bucket:</span><strong id="meta-bucket">—</strong></li>
                    <li><span>Source:</span><strong id="meta-source">—</strong></li>
                    <li><span>Confidence:</span><strong id="meta-confidence">—</strong></li>
                    <li><span>Similarity:</span><strong id="meta-similarity">—</strong></li>
                  </ul>
                </div>
              </div>
            </div>
            <div id="batch-view" class="view-batch is-hidden">
              <div class="batch-controls">
                <span>Review multiple matches at once.</span>
                <div class="batch-controls__buttons">
                  <button id="batch-refresh-btn" type="button" title="Refresh Batch">Refresh Batch</button>
                  <button id="batch-clear-btn" type="button" title="Clear Decisions">Clear Decisions</button>
                  <button id="batch-commit-btn" type="button" disabled title="Commit Decisions">Commit Decisions</button>
                </div>
              </div>
              <div id="batch-grid" class="batch-grid">
                <p class="empty">No batch loaded yet.</p>
              </div>
            </div>
          </div>
          <div id="seed-controls" class="seed-controls is-hidden">
            <label>
              <span>Name this person</span>
              <input id="seed-label-input" type="text" placeholder="Enter full name" autocomplete="off" />
            </label>
            <button id="seed-save-btn" type="button" title="Save Label (Enter / T)">Save Label (Enter / T)</button>
          </div>
          <div class="candidate-panel__actions single-only">
            <button id="accept-btn" type="button" disabled title="Accept (T)">Accept (T)</button>
            <button id="reject-btn" type="button" disabled title="Reject (F)">Reject (F)</button>
            <button id="skip-btn" type="button" title="Skip (S)">Skip (S)</button>
            <button id="undo-btn" type="button" disabled title="Undo (U)">Undo (U)</button>
          </div>
          <div id="candidate-prompt" class="candidate-prompt is-hidden single-only">
            <span>All important people tagged in this photo?</span>
            <div class="candidate-prompt__actions">
              <button id="candidate-prompt-yes" type="button" title="Yes (Y)">Yes (Y)</button>
              <button id="candidate-prompt-no" type="button" title="No (N)">No (N)</button>
            </div>
          </div>
          <div class="ignore-panel single-only">
            <label>
              <span>Ignore reason</span>
              <select id="ignore-reason">
                <option value="background">Background / non-primary</option>
                <option value="false-positive">Not a face</option>
                <option value="partial">Partial / too small</option>
                <option value="crowd">Crowd / low value</option>
              </select>
            </label>
            <button id="ignore-btn" type="button" title="Ignore (B)">Ignore (B)</button>
            <button id="crowd-btn" type="button" class="crowd-btn" title="Ignore Remaining In Photo (Crowd)">Ignore Remaining In Photo (Crowd)</button>
          </div>
          <div class="audit-panel">
            <div class="audit-panel__header">
              <div class="audit-panel__titles">
                <h3>Confirmed</h3>
                <div class="audit-panel__tabs">
                  <button id="audit-faces-btn" type="button" class="is-active" title="Faces">Faces</button>
                  <button id="audit-photos-btn" type="button" title="Photos">Photos</button>
                </div>
              </div>
              <div class="audit-panel__actions">
                <label class="audit-toggle">
                  <input id="audit-show-rejected" type="checkbox" />
                  <span id="audit-show-rejected-label">Show rejected</span>
                </label>
                <button id="audit-refresh-btn" type="button" title="Refresh">Refresh</button>
              </div>
            </div>
            <div class="audit-panel__body">
              <div id="audit-list" class="audit-list">
                <p class="empty">Select a label to see confirmed faces.</p>
              </div>
              <div id="audit-photo-list" class="audit-photo-list is-hidden">
                <p class="empty">Select a label to see confirmed photos.</p>
              </div>
              <button id="audit-photo-load-more" type="button" class="audit-photo-load-more is-hidden" title="Load more">
                Load more
              </button>
            </div>
          </div>
          </div>
          <div id="cluster-mode" class="cluster-mode is-hidden">
            <div class="cluster-toolbar">
              <div>
                <h3>Clusters</h3>
                <p id="cluster-summary">Switch to Clusters to load unlabeled groups.</p>
              </div>
              <div class="cluster-toolbar__actions">
                <label class="cluster-min-faces">
                  <span>Min faces</span>
                  <input id="cluster-min-faces" type="number" min="1" max="50" value="3" />
                </label>
                <label class="cluster-similarity">
                  <span>Similarity</span>
                  <input id="cluster-similarity" type="range" min="0.60" max="0.95" step="0.01" value="0.83" />
                  <strong id="cluster-similarity-value">0.83</strong>
                </label>
                <label class="cluster-toggle">
                  <input id="cluster-show-low-conf" type="checkbox" />
                  <span>Show junk</span>
                </label>
                <button id="cluster-refresh-btn" type="button" title="Refresh">Refresh</button>
              </div>
            </div>
            <p id="cluster-status" class="cluster-status"></p>
            <div id="cluster-grid-view" class="cluster-grid">
              <p class="empty">No clusters loaded yet.</p>
            </div>
            <div id="cluster-grid-footer" class="cluster-grid-footer">
              <button id="cluster-load-more-btn" type="button" title="Load More">Load More</button>
            </div>
            <div id="cluster-review" class="cluster-review is-hidden">
                              <div class="cluster-review__header">
                                <button id="cluster-back-btn" type="button" class="cluster-back-btn" title="← Clusters">← Clusters</button>
                                <button id="cluster-jump-tagger-btn" type="button" class="cluster-jump-btn" title="Open this photo in Photo Tagger to label other people (P)">
                                  Tag other faces…
                                </button>
                                <div>
                                  <h3 id="cluster-review-title">Cluster</h3>                  <p id="cluster-review-count"></p>
                </div>
                <div class="cluster-review__actions" id="cluster-actions">
                  <label>
                    <span>Name entire cluster</span>
                    <input id="cluster-label-input" type="text" placeholder="Enter name" autocomplete="off" />
                  </label>
                  <button id="cluster-name-btn" type="button" title="Name Cluster (N)">Name Cluster (N)</button>
                  <div class="cluster-face-actions is-hidden" id="cluster-face-actions">
                    <label>
                      <span>Assign selected face</span>
                      <select id="cluster-face-label-select"></select>
                    </label>
                    <button id="cluster-face-assign-btn" type="button" title="Assign (T)">Assign (T)</button>
                    <button id="cluster-face-ignore-btn" type="button" title="Ignore (I)">Ignore (I)</button>
                  </div>
                </div>
              </div>
              <div class="cluster-review__body">
                <div class="cluster-hero">
                  <div id="cluster-hero-wrapper" class="photo-hero__image">
                    <div id="cluster-zoom-canvas" class="photo-zoom-canvas">
                      <img id="cluster-hero-img" alt="Cluster hero" />
                      <div id="cluster-hero-overlay" class="photo-hero__overlay"></div>
                    </div>
                  </div>
                  <div class="cluster-hero__nav">
                    <button id="cluster-prev-face-btn" type="button" title="← Prev">← Prev</button>
                    <span id="cluster-face-counter">0 / 0</span>
                    <button id="cluster-next-face-btn" type="button" title="Next →">Next →</button>
                  </div>
                </div>
                <aside class="cluster-face-list-wrapper">
                  <h4>Faces in cluster</h4>
                  <ul id="cluster-face-list" class="cluster-face-list">
                    <li class="empty">Select a cluster to review.</li>
                  </ul>
                </aside>
              </div>
              <p class="cluster-review__hints">
                Hotkeys: Enter/T = Accept · F = Reject · I = Ignore · D = Mark done · N = Name · Esc = Back · ←/→ = Navigate
              </p>
            </div>
          </div>
          <div id="photo-mode" class="is-hidden">
            <div class="photo-controls">
              <div class="photo-controls__row">
                <div class="photo-controls__group">
                  <button id="photo-grid-toggle" type="button" aria-label="Back to grid" title="Back to grid">Back to Grid</button>
                  <button id="photo-refresh-btn" type="button" title="Refresh Photos">Refresh Photos</button>
                </div>
                <div class="photo-nav">
                  <button id="photo-prev-btn" type="button" title="← Prev">← Prev</button>
                  <span id="photo-counter">0 / 0</span>
                  <button id="photo-next-btn" type="button" title="Next →">Next →</button>
                </div>
              </div>
              <div class="photo-controls__modes">
                <button id="photo-mode-queue" type="button" class="is-active" title="Tagging Queue">Tagging Queue</button>
                <button id="photo-mode-review" type="button" title="Review Tagged">Review Tagged</button>
              </div>
              <div class="photo-controls__filters">
                <label>
                  <span>Priority Filter</span>
                  <select id="photo-priority-filter">
                    <option value="all">All priorities</option>
                    <option value="high">Only High</option>
                    <option value="normal">Only Normal</option>
                    <option value="low">Only Low</option>
                  </select>
                </label>
                <label>
                  <span>Min Confidence</span>
                  <input id="photo-min-confidence" type="number" min="0" max="1" step="0.05" value="0.65" />
                </label>
                <label>
                  <span>Min Face Area</span>
                  <input id="photo-min-face-area" type="number" min="0" max="1" step="0.001" value="0.003" />
                </label>
                <label class="photo-controls__toggle">
                  <input id="photo-hide-labeled" type="checkbox" />
                  <span>Hide labeled faces</span>
                </label>
              </div>
              <p id="photo-status" class="photo-status"></p>
            </div>
            <div id="photo-grid-view" class="photo-grid">
              <p class="empty">Loading photos…</p>
            </div>
            <div id="photo-grid-footer" class="photo-grid__footer">
              <p id="photo-grid-summary"></p>
              <button id="photo-load-more-btn" type="button" title="Load More">Load More</button>
            </div>
            <div id="photo-hero-view" class="photo-hero is-hidden">
              <div id="photo-hero-image" class="photo-hero__image">
                <div id="photo-zoom-canvas" class="photo-zoom-canvas">
                  <img id="photo-hero-img" alt="Selected photo" />
                  <div id="photo-hero-overlay" class="photo-hero__overlay"></div>
                </div>
              </div>
              <div class="photo-hero__sidebar">
                <header class="photo-hero__header">
                  <div class="photo-hero__title-row">
                    <div>
                      <h3 id="photo-hero-title">Photo</h3>
                      <p id="photo-hero-subtitle"></p>
                    </div>
                    <div class="photo-hero__back-controls">
                      <button id="photo-back-toggle" type="button" class="photo-back-toggle is-hidden" title="Show Back">Show Back</button>
                      <div id="photo-back-rotate" class="photo-back-rotate is-hidden">
                        <button type="button" data-photo-rotate="ccw" aria-label="Rotate back counter clockwise" title="Rotate back counter clockwise">↶ 90°</button>
                        <button type="button" data-photo-rotate="cw" aria-label="Rotate back clockwise" title="Rotate back clockwise">↷ 90°</button>
                        <button type="button" data-photo-rotate="reset" title="Reset">Reset</button>
                      </div>
                    </div>
                  </div>
                  <div class="photo-hero__toolbar">
                    <div id="photo-priority-toggle" class="photo-priority-toggle">
                      <span>Priority:</span>
                      <div class="photo-priority-toggle__buttons">
                        <button type="button" data-photo-priority="high" title="High">High</button>
                        <button type="button" data-photo-priority="normal" class="is-active" title="Normal">Normal</button>
                        <button type="button" data-photo-priority="low" title="Low">Low</button>
                      </div>
                    </div>
                    <button id="photo-done-toggle" type="button" class="photo-done-toggle" title="Mark Done">Mark Done</button>
                    <button id="photo-done-next" type="button" class="photo-done-toggle" title="Done + Next">Done + Next</button>
                    <button id="photo-nuke-btn" type="button" class="photo-nuke-btn" title="Suppress all low-confidence detections in this bucket">
                      Nuke Junk
                    </button>
                    <button id="photo-reject-bucket-btn" type="button" class="photo-reject-btn is-hidden" title="Reject Photo for this person">
                      Reject Photo for this person
                    </button>
                    <div class="photo-hero__controls">
                      <button id="photo-overlay-toggle" type="button" class="photo-overlay-toggle" title="Hide Boxes">Hide Boxes</button>
                      <button id="photo-draw-toggle" type="button" class="photo-draw-toggle" title="Draw Box">Draw Box</button>
                      <button id="photo-redetect-btn" type="button" class="photo-redetect-btn" title="Re-detect">Re-detect</button>
                      <div class="photo-zoom-controls">
                        <button id="photo-zoom-out" type="button" aria-label="Zoom out" title="Zoom out">−</button>
                        <input id="photo-zoom-slider" type="range" min="0.6" max="2.5" step="0.1" value="1" aria-label="Zoom level" title="Zoom level" />
                        <button id="photo-zoom-in" type="button" aria-label="Zoom in" title="Zoom in">+</button>
                        <button id="photo-zoom-reset" type="button" aria-label="Reset zoom" title="Reset zoom">Reset</button>
                        <button id="photo-zoom-lock" type="button" aria-pressed="false" title="Lock">Lock</button>
                        <span id="photo-zoom-value">1.0×</span>
                      </div>
                    </div>
                  </div>
                </header>
                <div id="photo-reject-badge" class="photo-hero__alert photo-hero__alert--reject is-hidden"></div>
                <div id="photo-hero-alert" class="photo-hero__alert is-hidden"></div>
                <div id="photo-face-list" class="photo-face-list">
                  <p class="empty">Select a photo to begin.</p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
      <footer class="queue-app__footer">
        Labeled faces persist to <code>config/face_tags.csv</code>. Rejections persist to <code>config/face_votes.csv</code>.
      </footer>
    </div>
    <div id="merge-dialog" class="merge-dialog is-hidden" aria-hidden="true">
      <div class="merge-dialog__card">
        <div class="merge-dialog__header">
          <h3>Merge Labels</h3>
          <button id="merge-close-btn" type="button" aria-label="Close merge dialog" title="Close merge dialog">&times;</button>
        </div>
        <p class="merge-dialog__text">Combine duplicates by moving every confirmed face from one label into another.</p>
        <label>
          <span>Move faces from</span>
          <select id="merge-source"></select>
        </label>
        <label>
          <span>Into</span>
          <select id="merge-target"></select>
        </label>
        <p id="merge-error" class="merge-dialog__error is-hidden"></p>
        <div class="merge-dialog__actions">
          <button id="merge-confirm-btn" type="button" title="Merge Labels">Merge Labels</button>
          <button id="merge-cancel-btn" type="button" title="Cancel">Cancel</button>
        </div>
      </div>
    </div>
    <script src="queue_data.js"></script>
    <script src="queue_app.js?v=20251230_8"></script>
  </body>
</html>
